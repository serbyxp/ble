[platformio]
build_dir = .pio/build
default_envs = nodemcu-32s

[env:nodemcu-32s]
platform = espressif32
board = nodemcu-32s
framework = arduino
upload_speed = 460800
monitor_speed = 115200
board_build.partitions = huge_app.csv

# CRITICAL: Arduino ESP32 build flags for BLE/WiFi coexistence
build_flags = 
    # Enable verbose logging for debugging
    -DCORE_DEBUG_LEVEL=4
    
    # Enable Bluetooth
    -DCONFIG_BT_ENABLED=1
    
    # BLE mode only (not classic Bluetooth)
    -DCONFIG_BTDM_CONTROLLER_MODE_BLE_ONLY=1
    
    # Software coexistence between BLE and WiFi - MOST IMPORTANT
    -DCONFIG_SW_COEXIST_ENABLE=1
    
    # Larger stacks for BLE operations
    -DCONFIG_BTDM_CTRL_HCI_MODE_VHCI=1
    
    # Optimize for coexistence
    -DCONFIG_BTDM_MODEM_SLEEP_MODE_ORIG=1

# For menuconfig-style options in Arduino, we use board_build.arduino.memory_type
board_build.arduino.memory_type = qio_qspi

lib_deps =
    links2004/WebSockets@2.7.1
    bblanchon/ArduinoJson@^7.4.2

# Monitor settings
monitor_filters = 
    colorize
    
monitor_flags =
    --raw
    --eol=LF

# Don't use esptool compression - can cause issues
upload_flags =
    --no-stub

# Optional: If you want menuconfig access (advanced)
# Run: pio run -t menuconfig
extra_scripts = 
    pre:scripts/install_intelhex.py